<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<meta name="author" content="David Hu">

  	<title>snapgraph</title>
	<link rel="stylesheet" href="../css/bootstrap.css" />
	<link rel="stylesheet" href="../fortawesome/css/font-awesome.min.css" />
	<link href="../css/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Grand+Hotel' rel='stylesheet' type='text/css'>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../js/graph.js"></script>
	<script type="text/javascript" src="../js/bootstrap.js"></script>
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body>

  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=556307127714880";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>

  <div id="social">
    <div class="fb-like" data-href="http://graphsearch.heroku.com/" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false" data-font="arial">
    </div>
    
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://graphsearch.heroku.com">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    <!-- Place this tag where you want the +1 button to render. -->
    <div class="g-plusone" data-size="medium" data-href="http://graphsearch.heroku.com"></div>

    <!-- Place this tag after the last +1 button tag. -->
    <script type="text/javascript">
      (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>

  </div>


	<a href="https://github.com/Jasdev/snapgraph/wiki/Documentation"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
	<div id="top">
		<h1>snapgraph</h1>
		<div id="searchStatus" class="icon-search" style="position:relative;left:30px;top:-3px;"></div>
		<input type="text" id="search" />
		<i class="icon-globe icon-2x" id="globe"></i>
	</div>
	<div id="highscores">
		<table style="display:none;">
			<thead>
				<tr class="nohover">
					<td>Name</td>
					<td>HISCORE</td>
				</tr>
			</thead>
			<tbody id="hiscorebody">
				
			</tbody>
		</table>
	</div>
	<div id="main">
		<div id="tooltip" style="position:absolute;"></div>
		<div id="chart"></div>
	</div>

	<div id="help">
		<h1 id="sub"> View your Snapchat network </h1>
		<p id="subtext">Enter your Snapchat username to see your best friends!</p>
	</div>

	<div id="bottom">

		<a id="david" target="_blank" href="http://twitter.com/octopi" rel="tooltip">
			<img src="../img/david.jpg" class="img-circle" />
		</a>

		<a id="jasdev" target="_blank" href="http://twitter.com/justdavesingh" rel="tooltip">
			<img src="../img/jasdev.png" class="img-circle" />
		</a>

		<a id="nishant" target="_blank" href="http://twitter.com/binroo" rel="tooltip">
			<img src="../img/nishant.jpg" class="img-circle" />
		</a>

		<p>A <a href="http://2013s.pennapps.com/" target="_blank">Pennapps</a> Spring 2013 Hack</p>

		<div id="links">
			<a href="http://github.com/Jasdev/snapgraph" target="_blank">GitHub</a>
			&middot;
			<a href="https://github.com/Jasdev/snapgraph/wiki/Documentation" target="_blank">Wiki</a>	
		</div>
		

	</div>
	<img src="../img/graphs.png" id="graphbg" />


	<script>

	$(document).ready(function() {
		$("#david").tooltip({
		   'title': 'David Hu, <font color="#1f8f92">@octopi</font>',
		   'html': true,
		   'placement': 'left'
		 });

		$("#nishant").tooltip({
		   'title': 'Nishant Shukla, <font color="#1f8f92">@binroo</font>',
		   'html': true,
		   'placement': 'right'
		 });

		$("#jasdev").tooltip({
		   'title': 'Jasdev Singh, <font color="#1f8f92">@justdavesingh</fonts>',
		   'html': true,
		   'placement': 'top'
		 });

		// tooltip always follows mouse
		$('body').mousemove(function(e) {
			$('#tooltip').css({'top': e.clientY + 20, 'left': e.clientX});
		});

		// clicking the globe shows
		var showing = false;
		$('#globe').click(function() {
			if(!showing) {
				// get high scores
				$.ajax({
					url: 'leaderboard'
				}).done(function(result) {
					$('#hiscorebody').html('');
					for(var i = 0; i < result.length; i++) {
						$('#hiscorebody').append('<tr ' + (i % 2 === 0 ? 'class="zebra1"' : '') + '><td>'+result[i]._id+'</td><td>'+result[i].score+'</td></tr>');
					}
					$('#highscores table').show('slide', {direction: 'up'}, 400);
				});
			} else {
				$('#highscores table').hide('slide', {direction: 'up'}, 400);
			}
			showing = !showing;
		});

		// clicking a tr shows their graph
		$(document).on('click', '#hiscorebody tr', function(e) {
			var user = $(this)[0].firstChild.innerHTML;
			newGraph(user);
		});

		// text search
		$('#search').keypress(function(e) {
			if(e.which === 13) {
				var user = $('#search').val();
				newGraph(user);
				e.preventDefault();
			}
		}); // end #search.keypress

		function newGraph(user) {
			magToLoading();
			$('#search').val(user);
			$('#highscores table').hide('slide', {direction: 'up'}, 400);
			$('#chart').html('');
			$('#top').animate({
				marginTop: '2%'
			}, 400, function() { console.log('done'); });
			$('#chart').fadeIn(400, function() {
				var graph = new myGraph("#chart");
				addToGraph(graph, user);
			});
		}

		function addToGraph(graph, name) {
			$.ajax({
				url: 'getuser?u=' + name
			}).done(function(result) {
				console.log('DONE', result);
				loadingToMag();

				if(result.error) {
					$('#top').effect('shake', {times: 4, distance:5}, 200);
				}
				if(result.children.length === 0) {
					graph.addNode(name);						
				} else {
					for(var i = 0; i < result.children.length; i++) {
						var f = result.children[i].name;

						graph.addNode(name);
						graph.addNode(f);
						graph.addLink(name, f, result.children[i].score);

					}
				}
			});

			// clicking node shows more
			$(document).on('click', 'g', function(e) {
				magToLoading();
				addToGraph(graph, e.currentTarget.__data__.id);
				$('#search').val(e.currentTarget.__data__.id);
			});
		}


		function magToLoading() {
			$('#searchStatus').attr('class', '');
			$('#searchStatus').addClass('icon-repeat');
			$('#searchStatus').addClass('icon-spin');
			$('#search').prop('disabled', true);
		}
		function loadingToMag() {
			$('#searchStatus').attr('class', '');
			$('#searchStatus').addClass('icon-search');
			$('#search').prop('disabled', false);
		}
	});
	</script>
</body>
</html>
